<body>

    <app-navbar></app-navbar>

    <section class="mb-2 py-5 mt-2" style="background-color: #eee;">
        <div class="card card-registration border-0" style="background-color: #eee;">
            <div class="container py-5 h-100">
                <h3 class="text-center mt-3">Edit your landholding</h3>
                <div class="text-center">
                    <div class="spinner-border" style="width: 3rem; height: 3rem;" id="spinner" role="status"></div>
                </div>
                <div class="row d-flex justify-content-center align-items-center h-100">
                    <div class="col" style="display: none;" id="contentOfEdit1">
                        <form class="col-xl-12" [formGroup]="editLandholdingForm">
                            <div class="card-body p-md-4 text-black">
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="form-outline">
                                            <input formControlName="title" type="text" id="title"
                                                class="form-control form-control-lg" />
                                            <label class="form-label mt-1" for="title">Title</label>
                                        </div>
                                        <div *ngIf="(editLandholdingForm.controls['title'].dirty && editLandholdingForm.hasError('required', 'title'))"
                                            class="text-danger">*Title is required</div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <input formControlName="yearOfConstruction" type="text" id="yearOfConstruction"
                                            class="form-control form-control-lg" />
                                        <label for="yearOfConstruction">Year of construction</label>
                                        <div *ngIf="(editLandholdingForm.controls['yearOfConstruction'].dirty && editLandholdingForm.hasError('required', 'yearOfConstruction'))"
                                            class="text-danger">*Year of construction is required</div>
                                        <div *ngIf="editLandholdingForm.controls['yearOfConstruction'].dirty && editLandholdingForm.hasError('pattern', 'yearOfConstruction')"
                                            class="text-danger">*Year of construction is invalid</div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="form-outline">
                                            <div class="form-outline">
                                                <select formControlName="city" id="town" class="form-select">
                                                    <option disabled>Location</option>
                                                    <option *ngFor="let city of cities"
                                                        [selected]="city == landholding.city">
                                                        {{city.title}}
                                                    </option>
                                                </select>
                                            </div>
                                            <label class="form-label mt-1" for="town">Town</label>
                                        </div>
                                        <div *ngIf="(editLandholdingForm.controls['city'].dirty && editLandholdingForm.hasError('required', 'city'))"
                                            class="text-danger">*City is required</div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="form-outline">
                                            <input formControlName="address" type="text" id="address"
                                                class="form-control form-control-lg" />
                                            <label class="form-label mt-1" for="address">Address</label>
                                        </div>
                                        <div *ngIf="(editLandholdingForm.controls['address'].dirty && editLandholdingForm.hasError('required', 'address'))"
                                            class="text-danger">*Address is required</div>
                                        <div *ngIf="editLandholdingForm.controls['address'].dirty && editLandholdingForm.hasError('pattern', 'address')"
                                            class="text-danger">*Address is invalid</div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="form-outline">
                                            <div class="form-outline">
                                                <select formControlName="materialType" id="materialType"
                                                    class="form-select">
                                                    <option disabled>Material</option>
                                                    <option *ngFor="let type of constructionTypes"
                                                        [selected]="type === landholding.constructionMaterial">
                                                        {{type}}
                                                    </option>
                                                </select>
                                            </div>
                                            <label class="form-label mt-1" for="materialType">Construction material
                                                type</label>
                                        </div>
                                        <div *ngIf="(editLandholdingForm.controls['materialType'].dirty && editLandholdingForm.hasError('required', 'materialType'))"
                                            class="text-danger">*Material type is required</div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="form-outline">
                                            <div class="form-outline">
                                                <select formControlName="type" id="type" class="form-select">
                                                    <option disabled>Type</option>
                                                    <option *ngFor="let type of landholdingTypes"
                                                        [selected]="type === landholding.landholdingType">
                                                        {{type}}
                                                    </option>
                                                </select>
                                            </div>
                                            <label class="form-label mt-1" for="type">Landholding type</label>
                                        </div>
                                        <div *ngIf="(editLandholdingForm.controls['type'].dirty && editLandholdingForm.hasError('required', 'type'))"
                                            class="text-danger">*Landholding type is required</div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12 mb-4">
                                        <div class="form-outline">
                                            <div class="form-outline">
                                                <select formControlName="stage" id="stage" class="form-select">
                                                    <option disabled>Stage</option>
                                                    <option *ngFor="let stage of constructionStages"
                                                        [selected]="stage === landholding.constructionStage">
                                                        {{stage}}
                                                    </option>
                                                </select>
                                            </div>
                                            <label class="form-label mt-1" for="stage">Construction stage</label>
                                        </div>
                                        <div *ngIf="(editLandholdingForm.controls['stage'].dirty && editLandholdingForm.hasError('required', 'stage'))"
                                            class="text-danger">*Landholding construction stage is required</div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="form-outline">
                                            <input type="number" formControlName="numberOfFloors" id="totalFloors"
                                                class="form-control form-control-lg" min="0" />
                                            <label class="form-label mt-1" for="totalFloors">Amount of floors <br>(leave
                                                empty if not applicable)</label>
                                        </div>
                                        <div *ngIf="(editLandholdingForm.controls['numberOfFloors'].dirty && editLandholdingForm.hasError('min', 'numberOfFloors'))"
                                            class="text-danger">*Please enter a positive number</div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="form-outline">
                                            <input type="number" formControlName="floorOfResidence" id="floor"
                                                class="form-control form-control-lg" min="0" />
                                            <label class="form-label mt-1" for="floor">Floor of residence <br>(leave
                                                empty if not applicable)</label>
                                        </div>
                                        <div *ngIf="(editLandholdingForm.controls['floorOfResidence'].dirty && editLandholdingForm.hasError('min', 'floorOfResidence'))"
                                            class="text-danger">*Please enter a positive number</div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <div class="form-outline">
                                            <input type="number" formControlName="area" id="area" min="0"
                                                class="form-control form-control-lg" />
                                            <label class="form-label mt-1" for="area">Area (in
                                                m<sup>2</sup>)</label>
                                        </div>
                                        <div *ngIf="(editLandholdingForm.controls['area'].dirty && editLandholdingForm.hasError('required', 'area'))"
                                            class="text-danger">*Area is required</div>
                                        <div *ngIf="(editLandholdingForm.controls['area'].dirty && editLandholdingForm.hasError('min', 'area'))"
                                            class="text-danger">*Please enter a positive number</div>
                                    </div>
                                    <div class="col-md-6 mb-4">
                                        <div class="form-outline">
                                            <input type="number" formControlName="courtyard" id="courtyard" min="0"
                                                class="form-control form-control-lg" />
                                            <label class="form-label mt-1" for="courtyard">Courtyard (in
                                                m<sup>2</sup>)</label>
                                            <div *ngIf="(editLandholdingForm.controls['courtyard'].dirty && editLandholdingForm.hasError('min', 'courtyard'))"
                                                class="text-danger">*Please enter a positive number</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="col" style="display: none;" id="contentOfEdit2">
                        <form class="col-xl-12" [formGroup]="editLandholdingForm">
                            <div class="card-body p-md-4 text-black">
                                <div class="form-outline mb-4">
                                    <input type="number" formControlName="price" id="price" min="0"
                                        class="form-control form-control-lg" />
                                    <label class="form-label mt-1" for="price">Price (in BGN)</label>
                                    <div *ngIf="(editLandholdingForm.controls['price'].dirty && editLandholdingForm.hasError('required', 'price'))"
                                        class="text-danger">*Price is required</div>
                                    <div *ngIf="(editLandholdingForm.controls['price'].dirty && editLandholdingForm.hasError('min', 'price'))"
                                        class="text-danger">*Please enter a positive number</div>
                                </div>

                                <div class="form-outline mb-4">
                                    <textarea class="form-control" formControlName="description"
                                        style="height: 15rem;"></textarea>
                                    <label class="form-label mt-1" for="description">Description</label>
                                    <div *ngIf="(editLandholdingForm.controls['description'].dirty && editLandholdingForm.hasError('required', 'description'))"
                                        class="text-danger">*Description is required</div>
                                    <div *ngIf="(editLandholdingForm.controls['description'].dirty && (editLandholdingForm.hasError('minlength', 'description') || editLandholdingForm.hasError('maxlength', 'description')))"
                                        class="text-danger">*Description has to be minimum of 15 characters and maximum
                                        of 500.</div>
                                </div>

                                <div class="row d-flex h-100">
                                    <div class="form-outline container">

                                        <div class="row">
                                            <div class="col-md-6 mb-4">
                                                <div class="form-outline">
                                                    <select id="feature" class="form-select" (change)="addToFeatures()">
                                                        <option selected disabled>Feature</option>
                                                        <option *ngFor="let feature of featuresDropDownList">
                                                            {{feature.title}}
                                                        </option>
                                                    </select>
                                                    <label class="form-label mt-1" for="feature">Choose features to be
                                                        added:</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-4">
                                                <table class="table-borderless py-1">
                                                    <tbody>
                                                        <tr *ngFor="let feature of landholding.features">
                                                            <td class="">{{feature}}</td>
                                                            <td><button class="btn btn-danger"
                                                                    (click)="removeFromFeatures(feature)">X</button>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="isActive" [checked]="isActive"
                                (change)="onToggleChecked()">
                            <label class="form-check-label" for="isActive">The offer is currently
                                <span class="text-success" *ngIf="isActive">
                                    active
                                </span>
                                <span class="text-danger" *ngIf="!isActive">
                                    disabled
                                </span>!
                            </label>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-center pt-3" style="display: none;" id="contentOfEdit3">
                    <button type="submit" class="btn btn-info btn-lg ms-2" data-bs-toggle="modal"
                        data-bs-target="#pictureModal">Pictures</button>
                    <button type="submit" (click)="onUpdate()" class="btn btn-warning btn-lg ms-2">Update</button>
                    <button type="submit" class="btn btn-danger btn-lg ms-2" data-bs-toggle="modal"
                        data-bs-target="#deleteModal">Delete</button>&nbsp;
                </div>
            </div>
        </div>
    </section>
    <div class="modal fade" id="pictureModal" tabindex="-1" aria-labelledby="pictureModalLabel" area-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <p class="modal-title" id="pictureModalLabel"><span style="font-size: 25px;font-weight:700">Upload
                            pictures</span><br>
                        <small>Here you can add and remove pictures for your offer!</small>
                    </p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div id="landHodlingCarousel" class="carousel slide">
                    <div class="carousel-indicators">
                        <div *ngFor="let picture of landholding.pictures; let i = index;">
                            <button type="button" data-bs-target="#landHodlingCarousel" [attr.data-bs-slide-to]="i"
                                [class.active]="i === 0" aria-current="true" [attr.aria-label]="i"></button>
                        </div>
                    </div>
                    <div class="carousel-inner">
                        <div *ngFor="let picture of landholding.pictures;" class="carousel-item active">
                            <img [src]="picture" class="d-block w-100 rounded" alt="...">
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#landHodlingCarousel"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#landHodlingCarousel"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>

                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-info ms-2">Upload picture: <input type="file"
                            class="justify-content-end" multiple id="uploadPicture"
                            (change)="selectFile($event)"></button>
                    <button type="button" class="btn btn-danger" (click)="removePictures()">Clear pictures</button>
                </div>

            </div>
        </div>
    </div>
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" area-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <p class="modal-title" id="deleteModalLabel"><span style="font-size: 25px;font-weight:700">Are you
                            sure you want to delete your landholding?</span>
                    </p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="container">
                    <div class="row">
                        <button class="btn btn-success col" (click)="deleteLandholding()">Yes</button>
                        <button class="btn btn-danger col" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <app-footer></app-footer>

</body>